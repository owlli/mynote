# vim操作手册

20190302,今天查资料又了解了vim script,映射map和exec的资料,又是完全陌生的东西,以前还想把vim各个功能完全弄懂,现在发现vim实在太复杂了,只要会用就ok行了吧.



## 三种工作模式

不同的资料上不同的分法,<鸟哥的linux私房菜>中分为:一般模式、编辑模式和指令列命令模式



## vim编辑文件原理推测

在vim编辑一个文件test时，fuser -uv test是查询不到结果的，但是可以用fuser -uv .test.swp查询到此vim进程

推测:

vim工作原理应该是将原文件test复制到.test.swp中编辑，当编辑完成后执行:wq时.test.swp该名test将原文件test覆盖



## 查看vim自带教程

```shell
vimtutor
```

中文版

```shell
vimtutor zh
```

在vim内部看帮助

```shell
:help xxx
```

> xxx是想查看帮补的内容,可以是vim中set后面的选项



## 常用快捷键

### 移动光标

| 快捷键          | 效果                                                         |
| --------------- | ------------------------------------------------------------ |
| j或向下箭头键   | 光标向下移动一个字符,向下移动30行，可以使用"30j"或"30↓"的组合按键 |
| h或向左箭头键   | 光标向左移动一个字符                                         |
| k或向上箭头键   | 光标向上移动一个字符                                         |
| l或向右箭头键   | 光标向右移动一个字符                                         |
| e               | 向后移动一个单词的末尾（以字母和数字组成的词，以符号或空格分割，移动过程中会移动到符号处） |
| E               | 向后移动一个单词的末尾（以空格分隔的词）                     |
| w，b，nw，nb    | 向后/前移动一/n个单词的开头（以字母和数字组成的词，以符号或空格分割，移动过程中会移动到符号处） |
| W，B，nW，nB    | 向后/前移动一/n个单词的开头（以空格分隔的词）                |
| [Ctrl]+[f]      | 屏幕『向下』移动一页，相当于[Page Down]按键                  |
| [Ctrl]+[b]      | 屏幕『向上』移动一页，相当于[Page Up]按键                    |
| [Ctrl]+[d]      | 屏幕『向下』移动半页                                         |
| [Ctrl]+[u]      | 屏幕『向上』移动半页                                         |
| +               | 光标移动到非空格符的下一列                                   |
| -               | 光标移动到非空格符的上一列                                   |
| `n<space>`      | n表示『数字』，例如20。按下数字后再按空格键，光标会向右移动这一行的n个字符。例如`20<space>`则光标会向后面移动20个字符距离。 |
| 0或功能键[Home] | 这是数字『0』：移动到这一行的最前面字符处                    |
| $或功能键[End]  | 移动到这一行的最后面字符处                                   |
| H               | 光标移动到这个屏幕的最上方那一行的第一个字符                 |
| M               | 光标移动到这个屏幕的中央那一行的第一个字符                   |
| L               | 光标移动到这个屏幕的最下方那一行的第一个字符                 |
| G               | 移动到这个档案的最后一行                                     |
| nG              | n为数字。移动到这个档案的第n行。例如20G则会移动到这个档案的第20行(可配合:set nu) |
| gg              | 移动到这个档案的第一行，相当于1G啊！                         |
| `n<Enter>`      | n为数字。光标向下移动n行                                     |

### 搜索与取代

| 快捷键                                | 效果                                                         |
| ------------------------------------- | ------------------------------------------------------------ |
| /word                                 | 向光标之下寻找一个名称为word的字符串。例如要在档案内搜寻vbird这个字符串，就输入/vbird即可！ |
| ?word                                 | 向光标之上寻找一个字符串名称为word的字符串。                 |
| *                                     | 普通模式下，将光标移动到某个单词上面，敲shift+8，将向下搜索此单词，按n向下查找，按N向上查找 |
| #                                     | 普通模式下，将光标移动到某个单词上面，敲shift+3，将向上搜索此单词，按n向上查找，按N向下查找 |
| n                                     | 这个n是英文按键。代表『重复前一个搜寻的动作』。举例来说，如果刚刚我们执行 /vbird去向下搜寻vbird这个字符串，则按下n后，会向下继续搜寻下一个名称为vbird的字符串。如果是执行?vbird的话，那么按下n则会向上继续搜寻名称为vbird的字符串！ |
| N                                     | 这个N是英文按键。与n刚好相反，为『反向』进行前一个搜寻动作。例如 /vbird后，按下N则表示『向上』搜寻vbird。 |
| :n1,n2s/word1/word2/g                 | n1与n2为数字。在第n1与n2行之间寻找word1这个字符串，并将该字符串取代word2！举例来说，在100到200行之间搜寻vbird并取代为VBIRD则：『:100,200s/vbird/VBIRD/g』。 |
| :1,$s/word1/word2/g：%s/word1/word2/g | 从第一行到最后一行寻找word1字符串，并将该字符串取代为word2！ |
| :1,$s/word1/word2/gc                  | 从第一行到最后一行寻找word1字符串，并将该字符串取代为word2！且在取代前显示提示字符给用户确认(confirm)是否需要取代！ |
| :%s/word1//gn                         | 统计字符串word1在全文出现了多少次                            |

### 删除,复制与黏贴

| 快捷键  | 效果                                                         |
| ------- | ------------------------------------------------------------ |
| x,X     | 在一行字当中，x为向后删除一个字符(相当于[del]按键)，X为向前删除一个字符(相当于[backspace]亦即是退格键) |
| nx      | n为数字，连续向后删除n个字符。举例来说，我要连续删除10个字符，『10x』 |
| dd      | 删除游标所在的那一整列                                       |
| ndd     | n为数字。删除光标所在的向下n列，例如20dd则是删除20列         |
| dw      | 删除一个单词，（以字母和数字组成的词，以符号或空格分割，删除过程中会移动到符号处，删除时会自动将词或符号后的空格删除）如果光标不在单词开头，删除光标所在位置到单词结束处；如果是中文字符串，删除光标所在位置到中文字符串结束处 |
| d1G,dgg | 删除光标所在到第一行的所有数据                               |
| dG      | 删除光标所在到最后一行的所有数据                             |
| d$      | 删除游标所在处，到该行的最后一个字符                         |
| d0      | 那个是数字的0，删除游标所在处，到该行的最前面一个字符        |
| yy      | 复制游标所在的那一行                                         |
| nyy     | n为数字。复制光标所在的向下n列，例如20yy则是复制20列         |
| yw      | 复制一个单词，（以字母和数字组成的词，以符号或空格分割，光标如果在符号处，会将符号后下一个单词前所有字符复制）如果光标不在单词开头，复制光标所在位置到单词结束处；如果是中文字符串，复制光标所在位置到中文字符串结束处 |
| y1G     | 复制游标所在列到第一列的所有数据                             |
| yG      | 复制游标所在列到最后一列的所有数据                           |
| y0      | 复制光标所在的那个字符到该行行首的所有数据                   |
| y$      | 复制光标所在的那个字符到该行行尾的所有数据                   |
| p,P     | p为将已复制的数据在光标下一行贴上，P则为贴在游标上一行！举例来说，我目前光标在第 20行，且已经复制了10行数据。则按下p后，那 10行数据会贴在原本的20行之后，亦即由21行开始贴。但如果是按下P呢？那么原本的第 20行会被推到变成30行。 |

### 其他常用

| 快捷键 | 效果                                                         |
| ------ | ------------------------------------------------------------ |
| ~      | 将光标所在的字符转换大小写，可用v块选择                      |
| J      | 将光标所在列与下一列的数据结合成同一列                       |
| c      | 重复删除多个数据，例如向下删除10行，[10cj ]（不懂）          |
| u      | 撤销前一个动作，即office上的ctrl+z                           |
| ctrl+r | 恢复上一个动作，即office上的ctrl+y                           |
| .      | 重复前一个动作的意思。如果你想要重复删除、重复贴上等等动作，按下小数点『.』就好了 |



## 一般模式和编辑模式的切换

进入插入模式时左下角会出现『--INSERT--』或『--REPLACE--』字符

| 按键 | 效果                                                         |
| ---- | ------------------------------------------------------------ |
| i,I  | 进入插入模式(Insertmode)：i为『从目前光标所在处插入』，I为『在目前所在行的第一个非空格符处开始插入』 |
| a,A  | 进入插入模式(Insertmode)：a为『从目前光标所在的下一个字符处开始插入』，A为『从光标所在行的最后一个字符处开始插入』 |
| o,O  | 进入插入模式(Insert mode)：这是英文字母o的大小写。o为『在目前光标所在的下一行处插入新的一行』；O为在目前光标所在处的上一行插入新的一行 |
| r,R  | 进入取代模式(Replace mode)：r只会取代光标所在的那一个字符一次；R会一直取代光标所在的文字，直到按下ESC为止 |
| esc  | 退出编辑模式，回到一般模式中                                 |



## 指令模式命令

| 按键                | 效果                                                         |
| ------------------- | ------------------------------------------------------------ |
| :w                  | 将编辑的数据写入硬盘档案中                                   |
| :w!                 | 若文件属性为『只读』时，强制写入该档案。不过，到底能不能写入，<br/>还是跟你对该档案的档案权限有关啊 |
| :q                  | 离开vi                                                       |
| :q!                 | 若曾修改过档案，又不想储存，使用!为强制离开不储存档案        |
| :wq                 | 储存后离开，若为:wq!则为强制储存后离开                       |
| ZZ                  | 这是大写的Z喔！若档案没有更动，则不储存离开，若档案已经被更动过，则储存后离开 |
| :w[filename]        | 将编辑的数据储存成另一个档案（类似另存新档）                 |
| :r[filename]        | 在编辑的数据中，读入另一个档案的数据。亦即将『filename』这个档案内容加到游标所在行后面 |
| :r!command          | 执行命令command，并将输出插入至光标下方                      |
| :n1,n2 w [filename] | 将n1到n2的内容储存成filename这个档案                         |
| :! command          | 暂时离开vi到指令列模式下执行command的显示结果.例如『:!ls /home』即可在vi当中察看/home底下以ls输出的档案信息 |

### vi环境变更

| 按键             | 效果                                               |
| ---------------- | -------------------------------------------------- |
| :set nu          | 显示行号，设定之后，会在每一行的前缀显示该行的行号 |
| :set nonu        | 与set nu 相反，为取消行号                          |
| :set ff          | 显示文本是unix还是dos格式                          |
| :set ff=unix/dos | 设置文本格式                                       |
| :sh              | 从vim进入之前的bash中，exit或者ctrl+d重新回到vim中 |
| :set mouse=a     | 可以用鼠标控制vim界面                              |

更多vi环境选项请看后面的环境设定与记录：~/.vimrc,~/.viminfo



## 区块选择(Visual Block)

在一般模式下使用

| 按键   | 效果                                                |
| ------ | --------------------------------------------------- |
| v      | 字符选择，会将光标经过的地方反白选择                |
| V      | 行选择，会将光标经过的行反白选择                    |
| ctrl+v | 区块选择，可以用长方形的方式选择资料                |
| I      | 在ctrl+v之后使用，在选中的区块前插入字符，按esc结束 |
| y      | 将反白的地方复制起来                                |
| d      | 将反白的地方删除掉                                  |



## 多文件编辑

### vim直接打开多个文件

```shell
vim file1 file2...
```

| 按键          | 效果                                                         |
| ------------- | ------------------------------------------------------------ |
| :n，:next     | 编辑下一个档案                                               |
| :N，:prev     | 编辑上一个档案                                               |
| :e [filename] | 编辑时打开另一个文件                                         |
| :files，:ls   | 列出目前这个vim的开启的所有档案，%a表示文件在当前活动窗口，#表示上一个活动窗口 |

### vim多标签(tab page)打开多个文件

```shell
vim -p file1 file2...
```

| 按键                  | 效果                                                         |
| --------------------- | ------------------------------------------------------------ |
| ctrl+pgdn             | 切到下一个标签,如果在终端打开了多个标签(ctrl+shift+t),这会和终端的标签切换冲突 |
| ctrl+pgup             | 切到上一个标签,如果在终端打开了多个标签(ctrl+shift+t),这会和终端的标签切换冲突 |
| :tabnew [filename]    | 新建一个标签打开一个文件                                     |
| :tabc                 | 关闭当前标签                                                 |
| :tabo                 | 关闭所有其他的标签                                           |
| :tabs                 | 查看所有打开的标签                                           |
| :tabp或在一般模式按gT | 切到上一个标签                                               |
| :tabn或在一般模式按gt | 切到下一个标签                                               |

### vim多窗口打开多个文件

水平多窗口打开

```shell
vim -o file1 file2...
```

垂直多窗口打开

```shell
vim -O file1 file2...
```

| 按键                                | 效果                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| :sp [filename]                      | 在屏幕下方开启一个新窗口，水平分割屏幕，如果有加filename，表示在新窗口开启一个新档案，否则表示两个窗口为同一个档案内容(同步显示) |
| :vsp [filename]或:vsplit [filename] | 在屏幕左方开启一个新窗口，垂直分割屏幕，如果有加filename，表示在新窗口开启一个新档案，否则表示两个窗口为同一个档案内容(同步显示) |
| [ctrl]+w+j [ctrl]+w+↓                | 按键的按法是：先按下[ctrl]不放，再按下w后放开所有的按键，然后再按下j(或向下箭头键)，则光标可移动到下方的窗口 |
| [ctrl]+w+k [ctrl]+w+↑                | 同上，不过光标移动到上面的窗口                               |
| [ctrl]+w+q                          | 其实就是:q结束离开啦！举例来说，如果我想要结束下方的窗口，那么利用[ctrl]+w+↓移动到下方窗口后，按下:q即可离开，也可以按下 [ctrl]+w+q啊 |



## 环境设定与记录：~/.vimrc,~/.viminfo

这里只给出查看已设置的选项结果,各选项请看我的.vimrc文件

| 按键                  | 效果                                                         |
| --------------------- | ------------------------------------------------------------ |
| :set all              | 显示目前所有的环境参数设定值                                 |
| :set                  | 显示与系统默认值不同的设定参数，一般来说就是你有自行变动过的设定参数啦 |
| :syntax on :syntax off | 是否依据程序相关语法显示不同颜色？举例来说，在编辑一个纯文本档时，如果开头是以 # 开始，那么该行就会变成蓝色。如果你懂得写程序，那么这个 :syntax on 还会主动的帮你除错呢！但是，如果你仅是编写纯文本档案，要避免颜色对你的屏幕产生的干扰，则可以取消这个设定 |



## vim一些有用操作

### vim+cope+make的使用

1.进命令行模式执行:

 :cope

执行完成后,在vim的编辑界面下方出现一个新窗口

2.在命令行模式执行:

:set mouse=a

让vim支持鼠标选中

3.在命令行模式执行

:make

make的打印信息将会出现在新窗口中

### vim加密文件

1.vim编辑好文件后,进入命令行模式:

:X

2.输入两次密码

3.保存退出

4.再次打开时需要输入正确密码才可查看文件,否则文件显示乱码

5.必须正确输入密码后才能删除密码,否则在乱码状态下删除密码后,文件将永久乱码!

:set key=

6.保存退出

### vim中保存一个没有权限的文件

有的时候我们对一个文件编辑了很多,保存的时候发现没有写权限,我们可以这样

:w !sudo tee > /dev/null %

### vim历史命令

q:

搜索历史命令

q/

### 头文件的跳转

一般模式下将光标移到头文件上,按gf,即可打开头文件,按ctrl+o返回

一般模式下将光标移到头文件上,按ctrl+w,再按f,即可垂直在上面开一个窗口打开头文件

一般模式下将光标移到头文件上,按ctrl+w,再按gf,即可新开一个标签打开头文件

如果提示"E447: Can't find file "mach/s5p6818_irq.h" in path",需要配置path,即头文件所在的路径:

:set path=xxxx

ubuntu18.04下的vim 8.0的默认path为path=.,/usr/include,,



## 其他资料

vim命令大全：ctolib.com/cheatsheets-Vim-command.html
